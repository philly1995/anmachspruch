<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="Cache-Control" content="no-store" />
  <meta http-equiv="Expires" content="0" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ballermann Anmachspruch Generator</title>
  <style>
    body { background-color: #fff0f5; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; text-align: center; padding: 36px 16px; }
    h1 { font-size: 2em; margin-bottom: 16px; }
    h2 { font-size: 1.6em; margin: 0 0 10px 0; }

    /* kompaktere Abstände zwischen Sektionen */
    .section { margin-top: 48px; }
    @media (min-width: 768px) { .section { margin-top: 64px; } }

    .button-container { display: flex; flex-direction: column; align-items: center; gap: 6px; }
    button { padding: 16px 36px; font-size: 1.1em; background-color: #ff69b4; border: none; border-radius: 12px; color: white; cursor: pointer; width: 100%; max-width: 320px; transition: transform 0.2s ease, box-shadow 0.2s ease; }
    button:active { transform: scale(0.96); box-shadow: 0 0 10px #ff69b4aa; }
    button[disabled] { opacity: .65; cursor: not-allowed; }

    /* --- Modal & Animationen (langsam/spannend) --- */
    .modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,.45); display: none; align-items: center; justify-content: center; z-index: 9999; padding: 20px; opacity: 0; }
    .modal { background: #fff; border-radius: 16px; padding: 22px; max-width: 520px; width: 100%; box-shadow: 0 10px 30px rgba(0,0,0,.25); text-align: left; opacity: 0; transform: translateY(28px) scale(0.97); }
    .show { display: flex !important; animation: backdropFadeSlow 900ms ease forwards; }
    .show .modal { animation: popSlow 1200ms ease forwards; }
    .modal h3 { margin: 0 0 10px; font-size: 1.4em; color: #aa007f; }
    .modal p { margin: 0 0 18px; color: #333; line-height: 1.5; }
    .actions { display: flex; justify-content: flex-end; gap: 10px; }
    .actions button { background: #ff69b4; border-radius: 10px; padding: 12px 18px; font-size: 1em; }

    @keyframes backdropFadeSlow { from { opacity: 0; } to { opacity: 1; } }
    @keyframes popSlow { 0% { opacity: 0; transform: translateY(28px) scale(0.97);} 70% { opacity: 1; transform: translateY(-4px) scale(1.02);} 100% { opacity: 1; transform: translateY(0) scale(1);} }

    @media (prefers-reduced-motion: reduce) {
      .show { animation: none; opacity: 1; }
      .show .modal { animation: none; opacity: 1; transform: none; }
    }

    /* alte Inline-Ausgaben sind obsolet */
    #spruch, #shot-output, #truth-output, #loader { display: none; }
  </style>
</head>
<body>
  <h1>Dieser QR-Code war deine beste Entscheidung heute!<br/>Oder auch nicht. Versuch dein Glück.</h1>

  <!-- Anmachspruch -->
  <div id="spruch-section" class="section button-container">
    <h2>Anmachspruch-Generator</h2>
    <button id="spruch-btn" onclick="zeigSpruch()">Zufälligen Anmachspruch generieren</button>
  </div>

  <!-- Pflicht oder Shot -->
  <div id="truth-section" class="section button-container">
    <h2>Pflicht oder Shot</h2>
    <button id="truth-btn" onclick="zeigAufgabe()">Zeig mir meine Aufgabe</button>
    <div class="small-text" style="font-size: 0.95em; color:#444;">Erfülle die Aufgabe oder trink einen Shot (oder einen großen Schluck deines Getränks). Du weißt nicht welchen Shot du trinken willst? Dann lass den Zufall unten entscheiden!</div>
  </div>

  <!-- Shots -->
  <div id="shot-section" class="section button-container">
    <h2>Welcher Shot als nächstes?</h2>
    <button id="shot-button" onclick="zeigShot()">Na schauen wir mal was wird</button>
  </div>

  <!-- Gästebuch (externer Link wie im Original) -->
  <div id="guestbook-section" class="section button-container">
    <h2>Gästebuch</h2>
    <button onclick="window.open('https://forms.gle/47Bvs727BKtzxNjv5','_blank')">Gästebuch öffnen</button>
  </div>

  <!-- Modals -->
  <div id="spruch-backdrop" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="spruch-title" aria-describedby="spruch-text">
    <div class="modal">
      <h3 id="spruch-title">Dein Spruch</h3>
      <p id="spruch-text"></p>
      <div class="actions"><button id="spruch-close" onclick="closeSpruchModal()">Weiter</button></div>
    </div>
  </div>

  <div id="coach-backdrop" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="coach-title" aria-describedby="coach-text">
    <div class="modal">
      <h3 id="coach-title">Zeit für Mut!</h3>
      <p id="coach-text">Hey, jetzt sprich die Person einfach an – so schwer kann das nicht sein!</p>
      <div class="actions"><button id="coach-ok" onclick="closeCoachModal()">Okay Chef!</button></div>
    </div>
  </div>

  <div id="shot-backdrop" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="shot-title" aria-describedby="shot-text">
    <div class="modal">
      <h3 id="shot-title">Dein Shot</h3>
      <p id="shot-text"></p>
      <div class="actions"><button id="shot-close" onclick="closeShotModal()">Prost!</button></div>
    </div>
  </div>

  <div id="cheat-backdrop" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="cheat-title" aria-describedby="cheat-text">
    <div class="modal">
      <h3 id="cheat-title">Erwischt!</h3>
      <p id="cheat-text">Das ist cheaten! Jetzt musst du ne Runde ausgeben!</p>
      <div class="actions"><button onclick="closeCheatModal()">Okay, du hast ja recht.</button></div>
    </div>
  </div>

  <div id="truth-backdrop" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="truth-title" aria-describedby="truth-text">
    <div class="modal">
      <h3 id="truth-title">Deine Aufgabe</h3>
      <p id="truth-text"></p>
      <div class="actions"><button id="truth-close" onclick="closeTruthModal()">Challenge accepted</button></div>
    </div>
  </div>

  <script>
    // --- Daten ---
    const sprueche = [
      "Ist dein Pullover aus Kamelhaar oder warum hast du so stabile Höcker?",
      "Willst du alleinerziehende Mutter werden?",
      "Isst du gerade Kaktuseis oder knistert’s zwischen uns?",
      "Hast du 2\u202fcm Platz und 15 Sekunden Zeit?",
      "Meiner ist nicht nur besonders klein, sondern auch extra dünn",
      "Heißt du Winnie? Weil wenn ich dich sehe denk ich mir Puuh.",
      "Was gibt es hier noch so für Sehenswürdigkeiten - außer dich natürlich?",
      "Wieso kann ich dich auf Spotify nicht finden? Ich hab doch nach Hottest Singles gesucht.",
      "Eigentlich bin ich ja niemand für nur eine Nacht aber für dich mach ich ne Ausnahme.",
      "Ich bin so schlecht im Bett, das muss man erlebt haben, um es zu glauben!",
      "Brauchst du noch einen schlechten Einfluss in deinem Leben?",
      "Ich bin vom ADAC – ich bin hier, um dich abzuschleppen.",
      "Du musst der wahre Grund für die Erderwärmung sein.",
      "Glaubst du an Liebe auf den ersten Blick oder soll ich nochmal reinkommen?",
      "Ich bin Möbelpacker, darf ich dir beim ausziehen helfen?",
      "Du wirst von Tag zu Tag hübscher, heute siehst du schon aus wie nächste Woche.",
      "Ich bin gut drauf, bist du gut drunter?",
      "Du siehst zerknittert aus, darf ich mal drüber bügeln?",
      "Ich will gar nicht mit dir ins Bett, das Sofa reicht mir.",
      "Wenn du mit mir rummachen willst, dann lächle einfach kurz.",
      "Ich bin Mathematiker und interessiere mich für mehrstellige Zahlen, gibst du mir deine Telefonnummer?",
      "Bist du Kommunist:in? Wenn ich dich sehe, merke ich wie der Aufstand in meiner Unterschicht losgeht.",
      "Daumenwrestling ist out, ich mach das jetzt immer mit der Zunge. Lust eine Runde gegen mich zu spielen?",
      "Wegen dir habe ich Nackenschmerzen, du hast mir nämlich total den Kopf verdreht!",
      "Wenn du ein See voller Wasser wärst, wärst du eindeutig Süsswasser.",
      "Gibt es zufällig eine Doppelgängerin von dir? Nein? Dann steht jetzt eindeutig die schönste Frau der Welt vor mir!",
      "Ich weiß zwar nicht, wer du bist, aber ich glaube, ich würde es gerne wissen.",
      "Kaufst du mir ein Eis? Du darfst danach auch an mir lecken.",
      "Bist du ein Kater? Weil ich das Gefühl hab, dass ich dich morgen noch spüren werde.",
      "Wenn du ein Cocktail wärst, wärst du definitiv 'Sex on the Beach'.",
      "Sag mal, tanzen wir jetzt oder warten wir auf den Soundtrack unserer Lovestory?",
      "Du kannst aufhören zu gucken, ich komm schon von alleine rüber",
      "Du siehst aus als wenn du gutes Frühstück machst, lass uns das testen",
      "Wie heißt du oder soll ich dich einfach Schatz nennen",
      "Mein Bett quietscht, willst du es reparieren oder nur mit mir testen?",
      "Ich steh auf ehrliche Männer, also: Willst du nur rummachen oder auch mit mir Frühstücken?",
      "Du siehst aus als hättest du schon mal ein Rohr verlegt, leg mir auch eins.",
      "Wenn du 'ne Pizza wärst, wär ich der Käse, der an dir klebt.",
      "Ich bin kein DJ, aber ich leg heute noch bei dir auf.",
      "Bist du Google? Weil du alles hast, wonach ich gesucht hab.",
      "Ich bin vom Gesundheitsamt – und du bist eindeutig zu heiß!"
    ];

    const shots = [
      "Tequila","Jägermeister","Sambuca","Berliner Luft","Wodka","Kleiner Feigling","Ficken Likör","Klopfer","Pfeffi","Whiskey","Korn","Underberg","Rum","JACKPOT - such dir was aus","Asbach Uralt","Hierbas","Palo","Kümmerling","Baileys","Ouzo","Mexikaner"
    ];

    const wahrheitOderShot = [
      "Mache einem Fremden ein merkwürdiges Kompliment",
      "Gib einem Fremden ein High Five und zieh kurz vorher zurück",
      "Ruf einen beliebigen Kontakt an: Wenn er rangeht, sag dass du gut zuhause angekommen bist, wenn nicht: Shot",
      "Umarme jemanden aus deiner Gruppe (oder einen Fremden) 10 Sekunden lang",
      "Versuch jemanden mit einem Anmachspruch aus dieser Seite anzumachen",
      "Tu so, als würdest du einen Heiratsantrag machen",
      "Trink aus dem Glas eines Freundes – ohne zu fragen.",
      "Sag einer fremden Person, dass du wie ein Promi aussiehst - möglichst absurd.",
      "Stell dich neben eine fremde Gruppe, die nett aussieht und klatsch 10 Sekunden lang - kommentarlos.",
      "Mach einem fremden Mann drei Komplimente über seine Schuhe.",
      "Geh zur Bar (oder irgendeiner Person mit Getränk) und frag, ob du einen \"Probeschluck\" kriegst.",
      "Frag eine fremde Person, ob sie dir ihr Lieblingsgetränk erklärt – und tu so, als wärst du total beeindruckt.",
      "Erzähle einer Fremden Person dass du ein ganz wildes Hobby hast und denk dir was möglichst merkwürdiges aus."
    ];

    // --- Helper: Zufall OHNE unmittelbare Wiederholung ---
    function pickDifferent(arr, last) {
      if (!arr || arr.length === 0) return null;
      if (arr.length === 1) return arr[0];
      let candidate = null; let safety = 0;
      do { candidate = arr[Math.floor(Math.random() * arr.length)]; safety++; } while (candidate === last && safety < 50);
      return candidate;
    }

    // --- State ---
    let lastSpruch = null;
    let lastShot = null;
    let lastTruth = null;
    let spruchClickCount = 0;
    let coachShown = false; // Coach nur einmal nach 10 Sprüchen
    let shotClickCount = 0;  // Cheat-Popup bei jedem 5.

    // --- Modal Helpers ---
    function showBackdrop(id){ const b = document.getElementById(id); b.classList.add('show'); }
    function hideBackdrop(id){ const b = document.getElementById(id); b.classList.remove('show'); }

    function showSpruchModal(text){
      const p = document.getElementById('spruch-text');
      p.textContent = '…';
      showBackdrop('spruch-backdrop');
      setTimeout(()=>{ p.textContent = text; document.getElementById('spruch-close').focus(); }, 700);
      if (navigator.vibrate) { try { navigator.vibrate(15); } catch(e){} }
    }
    function closeSpruchModal(){ hideBackdrop('spruch-backdrop'); }

    function showCoachModal(){ showBackdrop('coach-backdrop'); setTimeout(()=>document.getElementById('coach-ok').focus(),0); }
    function closeCoachModal(){ hideBackdrop('coach-backdrop'); }

    function showShotModal(text){
      const p = document.getElementById('shot-text');
      p.textContent = '…';
      showBackdrop('shot-backdrop');
      setTimeout(()=>{ p.textContent = text; document.getElementById('shot-close').focus(); }, 700);
    }
    function closeShotModal(){ hideBackdrop('shot-backdrop'); }

    function showCheatModal(){ showBackdrop('cheat-backdrop'); }
    function closeCheatModal(){ hideBackdrop('cheat-backdrop'); }

    function showTruthModal(text){
      const p = document.getElementById('truth-text');
      p.textContent = '…';
      showBackdrop('truth-backdrop');
      setTimeout(()=>{ p.textContent = text; document.getElementById('truth-close').focus(); }, 700);
    }
    function closeTruthModal(){ hideBackdrop('truth-backdrop'); }

    // --- Actions ---
    function zeigSpruch(){
      spruchClickCount++;
      const btn = document.getElementById('spruch-btn');
      btn.disabled = true;
      if (spruchClickCount > 10 && !coachShown) { coachShown = true; btn.disabled = false; showCoachModal(); return; }
      const final = pickDifferent(sprueche, lastSpruch); lastSpruch = final; showSpruchModal(final); btn.disabled = false;
    }

    function zeigShot(){
      shotClickCount++;
      const btn = document.getElementById('shot-button');
      btn.disabled = true;
      if (shotClickCount % 5 === 0) { btn.disabled = false; showCheatModal(); return; }
      const final = pickDifferent(shots, lastShot); lastShot = final; showShotModal(final); btn.disabled = false;
    }

    function zeigAufgabe(){
      const btn = document.getElementById('truth-btn');
      btn.disabled = true;
      const final = pickDifferent(wahrheitOderShot, lastTruth); lastTruth = final; showTruthModal(final); btn.disabled = false;
    }

    // --- Tests --- (UI-Tests nur manuell; Pure-Tests immer und ohne Popups)
    function runBasicTests(){
      try {
        console.log('[Tests] start');
        // Coach beim 11. Spruch (einmalig)
        spruchClickCount = 0; coachShown = false; for(let i=0;i<10;i++){ zeigSpruch(); }
        zeigSpruch(); if (!coachShown) console.error('Coach modal sollte beim 11. Klick erscheinen');
        // Cheat jeder 5. Shot
        shotClickCount = 0; for(let i=1;i<=10;i++){ zeigShot(); }
        // Truth zieht Aufgabe + zeigt Modal
        lastTruth = null; zeigAufgabe();
        console.log('[Tests] done');
      } catch(e) { console.error('[Tests] failed', e); }
    }

    function runPureTests(){
      try {
        console.log('[PureTests] start');
        let last = 'x';
        for (let i=0; i<100; i++) {
          const v = pickDifferent(['x','y','z'], last);
          if (v === last) console.error('Pure repeat on iteration', i);
          last = v;
        }
        console.log('[PureTests] done');
      } catch(e){ console.error('[PureTests] failed', e); }
    }

    function shouldRunTests(){
      try {
        const url = new URL(window.location.href);
        return url.searchParams.get('test') === '1' || window.location.hash.includes('debug');
      } catch(e){ return false; }
    }

    window.addEventListener('load', () => {
      if (shouldRunTests()) { runBasicTests(); } // UI-Tests nur mit ?test=1 oder #debug
      runPureTests();                             // immer, öffnet keine Popups
    });
  </script>
</body>
</html>
